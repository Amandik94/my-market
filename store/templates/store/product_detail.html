{% extends 'base.html' %}

{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-8">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="card-title mb-3">{{ product.name }}</h2>

          <p class="card-text text-muted">
            {{ product.description }}
          </p>

          <h4 class="mb-4">
            –¶–µ–Ω–∞: <span class="text-success">{{ product.price }} —Ç–≥.</span>
          </h4>

          <!-- –§–æ—Ä–º–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ JS -->
          <form method="post" action="{% url 'add_to_cart' product.id %}" class="d-flex gap-2">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary add-to-cart" data-id="{{ product.id }}">
              üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
            </button>
            <a href="{% url 'view_cart' %}" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</a>
            <a href="{% url 'product_list' %}" class="btn btn-outline-secondary">‚Üê –ù–∞–∑–∞–¥</a>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault(); // –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–π POST

            const productId = this.dataset.id;

            fetch(`/add-to-cart/${productId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'X-Requested-With': 'XMLHttpRequest',
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                // –æ–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—É –≤ navbar
                document.getElementById('cart-count').textContent = data.cart_count;
            })
            .catch(error => console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É:', error));
        });
    });
});
</script>
{% endblock %}
